<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mom's Shop</title>
  <link rel="stylesheet" href="style.css" />
  <!-- GSAP for the loader animation (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
</head>
<body>

  <!-- ===== Loader (line ‚Üí circle text ‚Üí search icon ‚Üí search bar) ===== -->
  <div id="loader">
    <svg id="loader-svg" viewBox="0 0 500 500" width="300" height="300" aria-hidden="true">
      <!-- Straight line path -->
      <path id="linePath" d="M 50 250 H 450" fill="none" stroke="none"/>
      <!-- Circle path for circular text -->
      <path id="circlePath" d="M 250,250 m -180,0 a 180,180 0 1,1 360,0 a 180,180 0 1,1 -360,0" fill="none" stroke="none"/>

      <!-- The text that follows a path -->
      <text id="loaderTextWrap" font-size="36" font-family="Poppins, Arial, sans-serif" fill="#1db954">
        <textPath id="loaderText" href="#linePath" startOffset="50%" text-anchor="middle" lengthAdjust="spacingAndGlyphs">
          Mom's Store
        </textPath>
      </text>
    </svg>

    <!-- Search icon that will ‚Äúmorph‚Äù to the real search bar -->
    <div id="searchIcon" aria-hidden="true">üîç</div>
  </div>

  <!-- ===== Main Site ===== -->
  <div id="main-content" style="display:none;">
    <header class="site-header">
      <nav class="topbar">
        <a class="brand" href="index.html">Mom's Shop</a>
        <a class="admin-link" href="admin.html">Admin</a>
      </nav>
      <div class="hero">
        <h1>Welcome to Mom's Shop</h1>
        <p>Quality products just for you ‚ú®</p>
      </div>

      <!-- Search bar (will be target for the loader morph) -->
      <div class="search-wrap">
        <input type="text" id="search" placeholder="Search products...">
      </div>
    </header>

    <main class="container">
      <h2>Our Products</h2>
      <div class="products" id="product-list"></div>
    </main>

    <!-- Floating Cart Button -->
    <button id="cart-btn" onclick="toggleCart()" aria-label="Open cart">
      üõí
      <span id="cart-count">0</span>
    </button>

    <!-- Slide-up Cart Panel -->
    <div id="cart-panel" aria-live="polite" aria-label="Shopping cart panel">
      <div class="cart-head">
        <h3>Your Cart</h3>
        <button class="close-cart" onclick="toggleCart()" aria-label="Close cart">‚úï</button>
      </div>
      <ul id="cart-items"></ul>
      <p class="cart-total"><strong>Total: ‚Ç¶<span id="total">0</span></strong></p>
      <button class="checkout-btn" onclick="checkout()">Checkout via WhatsApp</button>
    </div>
  </div>

  <script>
    /* ======================
       PRODUCTS + RENDERING
       ====================== */
    let products = JSON.parse(localStorage.getItem("products")) || [
      { id: 1, name: "Handmade Bag",   price: 5000,  img: "https://via.placeholder.com/600x500?text=Bag" },
      { id: 2, name: "African Dress",  price: 12000, img: "https://via.placeholder.com/600x500?text=Dress" },
      { id: 3, name: "Beaded Necklace",price: 2500,  img: "https://via.placeholder.com/600x500?text=Necklace" },
      { id: 4, name: "Head Wrap",      price: 2000,  img: "https://via.placeholder.com/600x500?text=Head+Wrap" }
    ];

    let cart = [];

    const productList = document.getElementById("product-list");
    const cartItems   = document.getElementById("cart-items");
    const totalEl     = document.getElementById("total");
    const cartCount   = document.getElementById("cart-count");

    function renderProducts(list = products) {
      productList.innerHTML = "";
      list.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="card-body">
            <h3>${p.name}</h3>
            <p class="price">‚Ç¶${p.price}</p>
            <button onclick="addToCart(${p.id})">Add to Cart</button>
          </div>
        `;
        productList.appendChild(card);
      });
    }

    function addToCart(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      cart.push(product);
      renderCart();
      // little bump animation on the cart button
      const btn = document.getElementById("cart-btn");
      btn.classList.add("bump");
      setTimeout(() => btn.classList.remove("bump"), 300);
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      renderCart();
    }

    function renderCart() {
      cartItems.innerHTML = "";
      let total = 0;
      cart.forEach((item, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <div class="ci">
            <span>${item.name}</span>
            <small>‚Ç¶${item.price}</small>
          </div>
          <button class="rm" aria-label="Remove item" onclick="removeFromCart(${i})">‚úï</button>
        `;
        cartItems.appendChild(li);
        total += item.price;
      });
      totalEl.textContent = total;
      cartCount.textContent = cart.length;
    }

    function toggleCart() {
      document.getElementById("cart-panel").classList.toggle("active");
    }

    function checkout() {
      if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
      }
      const order = cart.map(item => `${item.name} (‚Ç¶${item.price})`).join(", ");
      const total = totalEl.textContent;
      const message = encodeURIComponent(`Hello, I would like to order: ${order}. Total: ‚Ç¶${total}`);
      // Replace with mom's WhatsApp number, format 234XXXXXXXXXX (no +)
      window.open(`https://wa.me/234XXXXXXXXXX?text=${message}`, "_blank");
    }

    // Initial render
    renderProducts();
    renderCart();

    /* ======================
       SEARCH (live filter)
       ====================== */
    const searchInput = document.getElementById("search");
    searchInput.addEventListener("input", (e) => {
      const q = e.target.value.toLowerCase();
      const filtered = products.filter(p => p.name.toLowerCase().includes(q));
      renderProducts(filtered);
    });

    /* ======================
       LOADER ANIMATION FLOW
       ====================== */
    window.addEventListener("load", () => {
      const textPath   = document.getElementById("loaderText");
      const loader     = document.getElementById("loader");
      const main       = document.getElementById("main-content");
      const searchIcon = document.getElementById("searchIcon");

      // STEP 1: ‚ÄúMom‚Äôs Store‚Äù shows on the straight line (we fade it in)
      gsap.fromTo("#loaderTextWrap", {opacity: 0}, {opacity: 1, duration: 0.8, ease: "power2.out"});

      // STEP 2: After a short beat, switch the textPath to the circle so letters wrap around
      setTimeout(() => {
        textPath.setAttribute("href", "#circlePath");
      }, 1200);

      // STEP 3: Pop the search icon from the center of the circle
      setTimeout(() => {
        searchIcon.style.opacity = "1";
        searchIcon.style.transform = "scale(1)";
      }, 2200);

      // STEP 4: Morph icon to the actual search bar position
      setTimeout(() => {
        const iconRect  = searchIcon.getBoundingClientRect();
        const barRect   = searchInput.getBoundingClientRect();
        const dx = (barRect.left + barRect.width * 0.05) - (iconRect.left);
        const dy = (barRect.top  + barRect.height * 0.25) - (iconRect.top);

        // Animate icon moving & shrinking toward the search bar
        gsap.to("#searchIcon", {
          x: dx, y: dy, scale: 0.2, duration: 0.9, ease: "power3.inOut",
          onComplete: () => {
            // Reveal the real search bar with a gentle glow
            searchInput.classList.add("reveal");
          }
        });
      }, 3000);

      // STEP 5: Fade loader & show the site
      setTimeout(() => {
        loader.classList.add("fade");
        main.style.display = "block";
      }, 4100);
    });
  </script>
</body>
</html>